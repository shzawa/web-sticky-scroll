var content=function(){"use strict";var V=Object.defineProperty;var $=(o,u,m)=>u in o?V(o,u,{enumerable:!0,configurable:!0,writable:!0,value:m}):o[u]=m;var p=(o,u,m)=>$(o,typeof u!="symbol"?u+"":u,m);var _,N;const o=((N=(_=globalThis.browser)==null?void 0:_.runtime)==null?void 0:N.id)==null?globalThis.chrome:globalThis.browser;function u(s){return s}const m={matches:["<all_urls>"],async main(){const e=(await o.storage.local.get("urlPatterns")).urlPatterns||[],t=window.location.href;if(!(e.length===0||e.some(c=>new RegExp(c.pattern.replace(/\*/g,".*")).test(t)))){console.log("Notion Scroll Sticky: URLパターンに一致しないため無効化されています");return}console.log("Notion Scroll Sticky: 有効化されました");const i=document.createElement("style");i.textContent=`
      .notion-sticky-scroll-container {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 1000;
        background-color: rgba(255, 255, 255, 0.95);
        border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        padding: 8px 16px;
        font-weight: bold;
        max-height: 40vh;
        overflow-y: auto;
        transition: transform 0.3s ease;
        transform: translateY(-100%);
      }

      .notion-sticky-scroll-container.visible {
        transform: translateY(0);
      }

      .notion-sticky-scroll-item {
        margin: 4px 0;
        padding: 4px 0;
        border-bottom: 1px solid rgba(0, 0, 0, 0.05);
      }

      .notion-sticky-scroll-item:last-child {
        border-bottom: none;
      }

      .notion-sticky-scroll-h1 { font-size: 1.2rem; padding-left: 0; }
      .notion-sticky-scroll-h2 { font-size: 1.1rem; padding-left: 16px; }
      .notion-sticky-scroll-h3 { font-size: 1rem; padding-left: 32px; }
      .notion-sticky-scroll-h4 { font-size: 0.95rem; padding-left: 48px; }
      .notion-sticky-scroll-h5 { font-size: 0.9rem; padding-left: 64px; }
      .notion-sticky-scroll-h6 { font-size: 0.85rem; padding-left: 80px; }
    `,document.head.appendChild(i);const r=document.createElement("div");r.className="notion-sticky-scroll-container",document.body.appendChild(r);let l=[],a=null;const w=()=>{const c=Array.from(document.querySelectorAll("h1, h2, h3, h4, h5, h6"));if(c.length===0)return;const E=c.filter(d=>{const h=d.getBoundingClientRect();return h.top<=300&&h.bottom>-100});let C=E;if(E.length>0)l=E,a!==null&&(window.clearTimeout(a),a=null),r.classList.add("visible");else if(l.length>0)C=l,a===null&&(a=window.setTimeout(()=>{r.classList.remove("visible"),a=null},3e3));else{r.classList.remove("visible");return}r.innerHTML="";const k=C[0],z=parseInt(k.tagName.substring(1)),U=c.indexOf(k),K=[];K.push(k);for(let d=U-1;d>=0;d--){const h=c[d];parseInt(h.tagName.substring(1))<z&&K.unshift(h)}K.forEach(d=>{const h=d.tagName.toLowerCase(),f=document.createElement("div");f.className=`notion-sticky-scroll-item notion-sticky-scroll-${h}`,f.textContent=d.textContent,f.addEventListener("click",()=>{d.scrollIntoView({behavior:"smooth"})}),r.appendChild(f)})};let S=null,A=0;const M=100;window.addEventListener("scroll",()=>{const c=Date.now();c-A<M?(S!==null&&window.clearTimeout(S),S=window.setTimeout(()=>{requestAnimationFrame(w),S=null},M)):requestAnimationFrame(w),A=c},{passive:!0}),new MutationObserver(()=>{requestAnimationFrame(w)}).observe(document.body,{childList:!0,subtree:!0}),w()}};function b(s,...e){}const P={debug:(...s)=>b(console.debug,...s),log:(...s)=>b(console.log,...s),warn:(...s)=>b(console.warn,...s),error:(...s)=>b(console.error,...s)},v=class v extends Event{constructor(e,t){super(v.EVENT_NAME,{}),this.newUrl=e,this.oldUrl=t}};p(v,"EVENT_NAME",x("wxt:locationchange"));let T=v;function x(s){var e;return`${(e=o==null?void 0:o.runtime)==null?void 0:e.id}:content:${s}`}function L(s){let e,t;return{run(){e==null&&(t=new URL(location.href),e=s.setInterval(()=>{let n=new URL(location.href);n.href!==t.href&&(window.dispatchEvent(new T(n,t)),t=n)},1e3))}}}const g=class g{constructor(e,t){p(this,"isTopFrame",window.self===window.top);p(this,"abortController");p(this,"locationWatcher",L(this));p(this,"receivedMessageIds",new Set);this.contentScriptName=e,this.options=t,this.abortController=new AbortController,this.isTopFrame?(this.listenForNewerScripts({ignoreFirstEvent:!0}),this.stopOldScripts()):this.listenForNewerScripts()}get signal(){return this.abortController.signal}abort(e){return this.abortController.abort(e)}get isInvalid(){return o.runtime.id==null&&this.notifyInvalidated(),this.signal.aborted}get isValid(){return!this.isInvalid}onInvalidated(e){return this.signal.addEventListener("abort",e),()=>this.signal.removeEventListener("abort",e)}block(){return new Promise(()=>{})}setInterval(e,t){const n=setInterval(()=>{this.isValid&&e()},t);return this.onInvalidated(()=>clearInterval(n)),n}setTimeout(e,t){const n=setTimeout(()=>{this.isValid&&e()},t);return this.onInvalidated(()=>clearTimeout(n)),n}requestAnimationFrame(e){const t=requestAnimationFrame((...n)=>{this.isValid&&e(...n)});return this.onInvalidated(()=>cancelAnimationFrame(t)),t}requestIdleCallback(e,t){const n=requestIdleCallback((...i)=>{this.signal.aborted||e(...i)},t);return this.onInvalidated(()=>cancelIdleCallback(n)),n}addEventListener(e,t,n,i){var r;t==="wxt:locationchange"&&this.isValid&&this.locationWatcher.run(),(r=e.addEventListener)==null||r.call(e,t.startsWith("wxt:")?x(t):t,n,{...i,signal:this.signal})}notifyInvalidated(){this.abort("Content script context invalidated"),P.debug(`Content script "${this.contentScriptName}" context invalidated`)}stopOldScripts(){window.postMessage({type:g.SCRIPT_STARTED_MESSAGE_TYPE,contentScriptName:this.contentScriptName,messageId:Math.random().toString(36).slice(2)},"*")}verifyScriptStartedEvent(e){var r,l,a;const t=((r=e.data)==null?void 0:r.type)===g.SCRIPT_STARTED_MESSAGE_TYPE,n=((l=e.data)==null?void 0:l.contentScriptName)===this.contentScriptName,i=!this.receivedMessageIds.has((a=e.data)==null?void 0:a.messageId);return t&&n&&i}listenForNewerScripts(e){let t=!0;const n=i=>{if(this.verifyScriptStartedEvent(i)){this.receivedMessageIds.add(i.data.messageId);const r=t;if(t=!1,r&&(e!=null&&e.ignoreFirstEvent))return;this.notifyInvalidated()}};addEventListener("message",n),this.onInvalidated(()=>removeEventListener("message",n))}};p(g,"SCRIPT_STARTED_MESSAGE_TYPE",x("wxt:content-script-started"));let I=g;const F=Symbol("null");let R=0;class H extends Map{constructor(){super(),this._objectHashes=new WeakMap,this._symbolHashes=new Map,this._publicKeys=new Map;const[e]=arguments;if(e!=null){if(typeof e[Symbol.iterator]!="function")throw new TypeError(typeof e+" is not iterable (cannot read property Symbol(Symbol.iterator))");for(const[t,n]of e)this.set(t,n)}}_getPublicKeys(e,t=!1){if(!Array.isArray(e))throw new TypeError("The keys parameter must be an array");const n=this._getPrivateKey(e,t);let i;return n&&this._publicKeys.has(n)?i=this._publicKeys.get(n):t&&(i=[...e],this._publicKeys.set(n,i)),{privateKey:n,publicKey:i}}_getPrivateKey(e,t=!1){const n=[];for(let i of e){i===null&&(i=F);const r=typeof i=="object"||typeof i=="function"?"_objectHashes":typeof i=="symbol"?"_symbolHashes":!1;if(!r)n.push(i);else if(this[r].has(i))n.push(this[r].get(i));else if(t){const l=`@@mkm-ref-${R++}@@`;this[r].set(i,l),n.push(l)}else return!1}return JSON.stringify(n)}set(e,t){const{publicKey:n}=this._getPublicKeys(e,!0);return super.set(n,t)}get(e){const{publicKey:t}=this._getPublicKeys(e);return super.get(t)}has(e){const{publicKey:t}=this._getPublicKeys(e);return super.has(t)}delete(e){const{publicKey:t,privateKey:n}=this._getPublicKeys(e);return!!(t&&super.delete(t)&&this._publicKeys.delete(n))}clear(){super.clear(),this._symbolHashes.clear(),this._publicKeys.clear()}get[Symbol.toStringTag](){return"ManyKeysMap"}get size(){return super.size}}new H;function D(){}function y(s,...e){}const q={debug:(...s)=>y(console.debug,...s),log:(...s)=>y(console.log,...s),warn:(...s)=>y(console.warn,...s),error:(...s)=>y(console.error,...s)};return(async()=>{try{const{main:s,...e}=m,t=new I("content",e);return await s(t)}catch(s){throw q.error('The content script "content" crashed on startup!',s),s}})()}();
content;
